# SubterraneanRose Core Module
find_package(SDL2 CONFIG REQUIRED)
find_package(sdl2-mixer CONFIG REQUIRED)
find_package(sdl2-image CONFIG REQUIRED)
find_package(GLEW REQUIRED)

aux_source_directory(./src sys_src_list)
# Generate GIT information in C source
execute_process(
    COMMAND git log --pretty=format:"%h" -1
    WORKING_DIRECTORY ${CMAKE_SOURCE_DIR}
    OUTPUT_VARIABLE commit_id_str
)
# Remove the quotes around the hash value
string(REPLACE "\"" "" commit_id ${commit_id_str})
message(STATUS "Git commit id: ${commit_id}")
string(CONCAT git_info
    "/*File generated by source/sys/CMakeLists.txt */\n"
    "#include <stdint.h>\n"
    "uint64_t sr_git_commit_id=0x${commit_id}\;\n"
)
file(
    WRITE ${CMAKE_CURRENT_BINARY_DIR}/git_info.c
    ${git_info}
)

add_library("srose-sys" STATIC ${sys_src_list} ${CMAKE_CURRENT_BINARY_DIR}/git_info.c)
target_include_directories("srose-sys" PUBLIC ./include)

target_link_libraries("srose-sys" PUBLIC SDL2::SDL2)
target_link_libraries("srose-sys" PUBLIC SDL2::SDL2_mixer)
target_link_libraries("srose-sys" PUBLIC SDL2::SDL2_image)
target_link_libraries("srose-sys" PUBLIC GLEW::GLEW)
